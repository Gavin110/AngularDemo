function base64Encode(e){var t,n,r,o,i,a,c,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=0,l=0,p="",d=[];if(!e)return e;e=utf8Encode(e);do{t=e.charCodeAt(f++),n=e.charCodeAt(f++),r=e.charCodeAt(f++),s=t<<16|n<<8|r,o=s>>18&63,i=s>>12&63,a=s>>6&63,c=63&s,d[l++]=u.charAt(o)+u.charAt(i)+u.charAt(a)+u.charAt(c)}while(f<e.length);switch(p=d.join(""),e.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"="}return p}function utf8Encode(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t,n,r,o="",i=0;for(t=n=0,i=e.length,r=0;r<i;r++){var a=e.charCodeAt(r),c=null;a<128?n++:c=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==c&&(n>t&&(o+=e.substring(t,n)),o+=c,t=n=r+1)}return n>t&&(o+=e.substring(t,e.length)),o}function jsonEncode(e){var t=e,n=function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,function(e){var t=n[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},r=function(e,t){var o="",i=0,a="",c="",s=0,u=o,f=[],l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),typeof l){case"string":return n(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(o+="    ",f=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,i=0;i<s;i+=1)f[i]=r(i,l)||"null";return c=0===f.length?"[]":o?"[\n"+o+f.join(",\n"+o)+"\n"+u+"]":"["+f.join(",")+"]",o=u,c}for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(c=r(a,l))&&f.push(n(a)+":"+c);return c=0===f.length?"{}":o?"{"+f.join(",")+u+"}":"{"+f.join(",")+"}",o=u,c}};return r("",{"":t})}function intval(e,t){return null==t&&(t=10),parseInt(e,t)||0}function time(){return intval((new Date).valueOf()/1e3)}function createUID(){var e,t;return t=time(),e=intval(Math.random()*t),e<1e8&&(e+=1e8),[t.toString(16),e.toString(16)].join(".")}function dataToStr(e){return encodeURIComponent(base64Encode(jsonEncode(e)))}function init(e,t,n){var r=wx.getSystemInfoSync(),o=wx.getStorageSync(UUID_NAME),i="return";o||(o=createUID(),wx.setStorageSync(UUID_NAME,o),i="new"),systemInfo={uuid:o,userType:i,model:r.model,vh:r.windowHeight,vw:r.windowWidth,pixelRatio:r.pixelRatio,lib:"wx",sdkv:"1.2.0",appv:"",wxid:e,appid:t,os:r.platform,osv:r.system,cp:"",md:"",pl:"",ct:"",kw:"",account:"",latitude:"",longitude:""},wx.getNetworkType({success:function(e){systemInfo.net=e.networkType}}),setReferrer(n)}function setReferrer(e){try{if(!e)return;var t=e.query;if(e.scene){var n=e.scene||"";systemInfo.ct=n}systemInfo.cp=t.cp||"",systemInfo.md=t.md||"",systemInfo.pl=t.pl||"",systemInfo.kw=t.kw||""}catch(e){console.log(e)}}function track(e,t){_send({time:(new Date).getTime(),system:systemInfo,eventname:e||"",eventlabel:t||"",profile:userInfo})}function _trackForm(e,t){var n=(new Date).getTime();if(t&&"the"!==t.substring(0,3)){_send({time:n,system:{uuid:systemInfo.uuid,wxid:systemInfo.wxid,appid:systemInfo.appid,formid:t,lib:systemInfo.lib,account:systemInfo.account},eventname:e},e)}}function adTrack(e,t,n){var r=(new Date).getTime(),o=_clone(systemInfo);o.appid=e,_send({time:r,system:o,eventname:t||"",eventlabel:n||"",profile:userInfo})}function addUserIdentifier(e){var t={id:systemInfo.account};for(var n in e)t[n]=e[n];userInfo=t}function setRemote(e){config.remote=e}function _send(e,t){console.log("data",e);var e=dataToStr(e),n=config.remote||"https://jice.fw4.me",r="trackformid"===t?"wxfjc":"wxjc",o=n+"/"+r+".gif?data="+e;wx.request({url:o,success:function(e){}})}function _clone(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function B(e,t,n,r){if(e[t]){var o=e[t];e[t]=function(e){r?(o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments))),n.call(this,e,t)):(n.call(this,e,t),o.call.apply(o,[this].concat(Array.prototype.slice.call(arguments))))}}else e[t]=function(e){n.call(this,e,t)}}function setVersion(e){systemInfo.appv=e}function setOpenId(e){systemInfo.account=e}function openGetLocation(){_openLocation=!0}var systemInfo={},userInfo={},UUID_NAME="_smt_uid",config={},_referer="",_openLocation=!1,_jiceUtil={getCurrentPageItem:function(){var e="",t="";try{var n=getCurrentPages(),r=n[n.length-1],o=r.options||{},i=Object.keys(o),a=[];if(i&&i.length)for(var c=0;c<i.length;c++){var s=i[c];a.push(s+"="+o[s])}e=r.route,t=a.length?"?"+a.join("&"):""}catch(e){console.log(e)}return{url:e,query:t}}},jiceOldPage=Page;Page=function(e){B(e,"onShow",function(){var t="view";_referer&&(t="enter",_referer="");var n=_jiceUtil.getCurrentPageItem();track("page",{pagepath:n.url,pageQuery:n.query,pageTitle:e.jicePageTitle||"",pageType:t})}),B(e,"jiceFormSubmit",function(e){e&&e.detail&&e.detail.formId&&_trackForm("trackformid",e.detail.formId)}),jiceOldPage(e)};var jiceOldApp=App;App=function(e){B(e,"onLaunch",function(){track("applaunch")},!0),B(e,"onError",function(e){track("Error",{msg:e})}),B(e,"onShow",function(e){setReferrer(e),_referer=e.referrerInfo,_openLocation&&wx.getLocation({type:"wgs84",success:function(e){var t=e.latitude,n=e.longitude;systemInfo.latitude=t,systemInfo.longitude=n}})}),jiceOldApp(e)},module.exports={init:init,track:track,adTrack:adTrack,addUserIdentifier:addUserIdentifier,setRemote:setRemote,setVersion:setVersion,setOpenId:setOpenId,openGetLocation:openGetLocation};
